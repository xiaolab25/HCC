<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="1900" viewBox="0 0 1400 1900">
  <defs>
    <style>
      .title { font: 700 26px "Arial", sans-serif; fill: #1b2b34; }
      .subtitle { font: 600 18px "Arial", sans-serif; fill: #1b2b34; }
      .label { font: 14px "Arial", sans-serif; fill: #1b2b34; }
      .note { font: 12px "Arial", sans-serif; fill: #4f5b66; }
      .box { fill: #f6f8fb; stroke: #2f4f4f; stroke-width: 2; rx: 14; }
      .stage { fill: #e9f2ff; stroke: #2f4f4f; stroke-width: 2; rx: 16; }
      .arrow { stroke: #2f4f4f; stroke-width: 2.5; fill: none; }
    </style>
    <marker id="arrowhead" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#2f4f4f" />
    </marker>
  </defs>

  <text x="50" y="50" class="title">Bioinformatics Workflow Design: Spatial Fibroinflammatory Architecture in HCC</text>
  <text x="50" y="80" class="note">End-to-end multi-modal pipeline beyond current code (single-cell, bulk, spatial, and validation analyses)</text>

  <!-- Stage 1 -->
  <rect x="50" y="120" width="1300" height="310" class="stage" />
  <text x="70" y="160" class="subtitle">Phase 1: Single-Cell Reference Atlas Construction</text>
  <text x="70" y="190" class="label">Goal: define HCC microenvironment cell states and major lineages</text>

  <rect x="80" y="220" width="1240" height="70" class="box" />
  <text x="100" y="250" class="label">Data collection & integration</text>
  <text x="100" y="275" class="note">4 public HCC scRNA-seq datasets (GEO & Mendeley), 246,087 cells</text>

  <rect x="80" y="305" width="1240" height="70" class="box" />
  <text x="100" y="335" class="label">Pre-processing + batch correction + clustering</text>
  <text x="100" y="360" class="note">QC, normalize (10k counts/cell), log1p, Harmony by sample, UMAP + Leiden (res=1.2)</text>

  <rect x="80" y="390" width="1240" height="70" class="box" />
  <text x="100" y="420" class="label">Annotation + functional profiling</text>
  <text x="100" y="445" class="note">Marker genes, CNV inference, PROGENy, pySCENIC, scFEA; key states: ecmFibro_FAP, Mono_THBS1, Malig_EMTinf</text>

  <!-- Arrow to Stage 2 -->
  <line x1="700" y1="430" x2="700" y2="470" class="arrow" marker-end="url(#arrowhead)" />

  <!-- Stage 2 -->
  <rect x="50" y="470" width="1300" height="320" class="stage" />
  <text x="70" y="510" class="subtitle">Phase 2: Ecological Definition & Clinical Relevance</text>
  <text x="70" y="540" class="label">Goal: identify covarying cell modules and define FIR ecosystem</text>

  <rect x="80" y="565" width="1240" height="70" class="box" />
  <text x="100" y="595" class="label">Covariation analysis</text>
  <text x="100" y="620" class="note">ecmFibro_FAP covaries with Malig_EMTinf and Mono_THBS1 in scRNA-seq</text>

  <rect x="80" y="650" width="1240" height="70" class="box" />
  <text x="100" y="680" class="label">Bulk deconvolution</text>
  <text x="100" y="705" class="note">Build reference matrix from atlas; CIBERSORTx on TCGA-LIHC bulk RNA-seq</text>

  <rect x="80" y="735" width="1240" height="70" class="box" />
  <text x="100" y="765" class="label">Ecological module discovery</text>
  <text x="100" y="790" class="note">NMF (k=4) on deconvolved cell fractions; define FIR vs non-FIR by module enrichment</text>

  <rect x="80" y="820" width="1240" height="70" class="box" />
  <text x="100" y="850" class="label">Survival analysis</text>
  <text x="100" y="875" class="note">Cox regression + Kaplan–Meier for FIR association with overall survival</text>

  <line x1="700" y1="860" x2="700" y2="910" class="arrow" marker-end="url(#arrowhead)" />

  <!-- Stage 3 -->
  <rect x="50" y="910" width="1300" height="330" class="stage" />
  <text x="70" y="950" class="subtitle">Phase 3: Spatial Architecture Reconstruction</text>
  <text x="70" y="980" class="label">Goal: validate spatial organization and immune exclusion mechanisms</text>

  <rect x="80" y="1005" width="1240" height="95" class="box" />
  <text x="100" y="1035" class="label">Visium spatial transcriptomics (tissue scale)</text>
  <text x="100" y="1060" class="note">cell2location mapping; spatial co-localization of ecmFibro_FAP & Malig_EMTinf; interface definition</text>

  <rect x="80" y="1110" width="1240" height="110" class="box" />
  <text x="100" y="1140" class="label">Xenium in situ transcriptomics (cell scale)</text>
  <text x="100" y="1165" class="note">SpatialData + Scanpy; cellular neighborhoods (CN, 120 µm); distance-to-boundary gradients; polarity of markers (MMP14, SULF1)</text>

  <line x1="700" y1="1210" x2="700" y2="1260" class="arrow" marker-end="url(#arrowhead)" />

  <!-- Stage 4 -->
  <rect x="50" y="1260" width="1300" height="250" class="stage" />
  <text x="70" y="1300" class="subtitle">Phase 4: Mechanistic Circuitry Inference</text>
  <text x="70" y="1330" class="label">Goal: identify signaling networks sustaining FIR architecture</text>

  <rect x="80" y="1355" width="1240" height="70" class="box" />
  <text x="100" y="1385" class="label">Cell–cell communication</text>
  <text x="100" y="1410" class="note">CellPhoneDB ligand–receptor interactions; NicheNetR target prediction (e.g., TGFβ, CCL2)</text>

  <rect x="80" y="1440" width="1240" height="70" class="box" />
  <text x="100" y="1470" class="label">Pseudotime analysis</text>
  <text x="100" y="1495" class="note">Monocle2 (DDRTree) fibroblast activation trajectory; ecmFibro_FAP at terminal state</text>

  <line x1="700" y1="1490" x2="700" y2="1540" class="arrow" marker-end="url(#arrowhead)" />

  <!-- Stage 5 -->
  <rect x="50" y="1540" width="1300" height="300" class="stage" />
  <text x="70" y="1580" class="subtitle">Phase 5: Validation & Pan-cancer Extension</text>
  <text x="70" y="1610" class="label">Goal: validate spatial phenotype and test generality across cancers</text>

  <rect x="80" y="1635" width="1240" height="85" class="box" />
  <text x="100" y="1665" class="label">CODEX multiplex imaging</text>
  <text x="100" y="1690" class="note">Deep-learning segmentation + phenotyping; quantify immune density within FAP+ regions</text>

  <rect x="80" y="1730" width="1240" height="85" class="box" />
  <text x="100" y="1760" class="label">Pan-cancer spatial analysis</text>
  <text x="100" y="1785" class="note">Apply spatial pipeline to CRC and PDAC to test conservation of FIR topology</text>
</svg>
